<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="RentIt Booking - Reserve your videoke equipment.">
    <title>RentIt - Booking</title>
    
    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    
    <!-- Stylesheets -->
    <link rel="stylesheet" href="/shared/css/theme.css">
    <link rel="stylesheet" href="/shared/css/globals.css">
    <link rel="stylesheet" href="dashboard/dashboard.css">
    
    <!-- Favicon -->
    <link rel="icon" type="image/svg+xml" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>ðŸŽ¤</text></svg>">
</head>
<body>
    <div class="app-container">
        <!-- Sidebar Container (Injected by JS) -->
        <div id="sidebarContainer"></div>
        
        <!-- Main Content -->
        <main class="main-content">
            <!-- Topbar Container (Injected by JS) -->
            <div id="topbarContainer"></div>
            
            <!-- Content Area -->
            <div class="content-area" id="contentArea">
                <!-- Page Header -->
                <div class="page-header-dashboard">
                    <div class="page-header-info">
                        <h1 class="page-title">Book Equipment</h1>
                        <p class="page-subtitle">Complete the form below to reserve your rental.</p>
                    </div>
                    <div class="page-header-actions">
                        <a href="rentals.html" class="btn-back">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" width="16" height="16">
                                <path d="M19 12H5M12 19l-7-7 7-7"/>
                            </svg>
                            Back to Catalog
                        </a>
                    </div>
                </div>

                <!-- Booking Container -->
                <div class="booking-container">
                    <div class="booking-card">
                        <!-- Selected Item Header -->
                        <div class="booking-header">
                            <div class="booking-item-info">
                                <div class="booking-item-image" id="bookingItemImage">
                                    <img src="/assets/placeholder-karaoke.svg" alt="Selected item" onerror="this.src='data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 80 80%22><rect fill=%22%231E293B%22 width=%2280%22 height=%2280%22/><text x=%2250%%22 y=%2250%%22 fill=%22%2394A3B8%22 text-anchor=%22middle%22 dominant-baseline=%22middle%22 font-size=%2224%22>ðŸŽ¤</text></svg>'">
                                </div>
                                <div class="booking-item-details">
                                    <h2 class="booking-item-name" id="bookingItemName">Grand Videoke Symphony</h2>
                                    <div class="booking-item-price" id="bookingItemPrice">â‚±800 / day</div>
                                </div>
                            </div>
                        </div>

                        <!-- Booking Form -->
                        <form class="booking-form" id="bookingForm">
                            <div class="form-row">
                                <div class="form-group">
                                    <label class="form-label" for="startDate">Start Date</label>
                                    <input type="date" id="startDate" class="form-input" required>
                                </div>
                                <div class="form-group">
                                    <label class="form-label" for="endDate">End Date</label>
                                    <input type="date" id="endDate" class="form-input" required>
                                </div>
                            </div>

                            <div class="form-row">
                                <div class="form-group">
                                    <label class="form-label" for="deliveryTime">Preferred Delivery Time</label>
                                    <select id="deliveryTime" class="form-select" required>
                                        <option value="">Select time slot...</option>
                                        <option value="morning">Morning (8:00 AM - 12:00 PM)</option>
                                        <option value="afternoon">Afternoon (12:00 PM - 5:00 PM)</option>
                                        <option value="evening">Evening (5:00 PM - 8:00 PM)</option>
                                    </select>
                                </div>
                                <div class="form-group">
                                    <label class="form-label" for="pickupTime">Preferred Pickup Time</label>
                                    <select id="pickupTime" class="form-select" required>
                                        <option value="">Select time slot...</option>
                                        <option value="morning">Morning (8:00 AM - 12:00 PM)</option>
                                        <option value="afternoon">Afternoon (12:00 PM - 5:00 PM)</option>
                                        <option value="evening">Evening (5:00 PM - 8:00 PM)</option>
                                    </select>
                                </div>
                            </div>

                            <div class="form-row">
                                <div class="form-group full-width">
                                    <label class="form-label" for="deliveryAddress">Delivery Address</label>
                                    <input type="text" id="deliveryAddress" class="form-input" placeholder="Enter complete delivery address" required>
                                </div>
                            </div>

                            <div class="form-row">
                                <div class="form-group">
                                    <label class="form-label" for="contactNumber">Contact Number</label>
                                    <input type="tel" id="contactNumber" class="form-input" placeholder="+63 9XX XXX XXXX" required>
                                </div>
                                <div class="form-group">
                                    <label class="form-label" for="paymentMethod">Payment Method</label>
                                    <select id="paymentMethod" class="form-select" required>
                                        <option value="">Select payment...</option>
                                        <option value="cod">Cash on Delivery</option>
                                        <option value="gcash">GCash</option>
                                        <option value="bank">Bank Transfer</option>
                                        <option value="card">Credit/Debit Card</option>
                                    </select>
                                </div>
                            </div>

                            <div class="form-row">
                                <div class="form-group full-width">
                                    <label class="form-label" for="specialRequests">Special Requests (Optional)</label>
                                    <textarea id="specialRequests" class="form-textarea" placeholder="Any special setup requirements, additional items, or notes..."></textarea>
                                </div>
                            </div>
                        </form>

                        <!-- Booking Summary -->
                        <div class="booking-summary">
                            <div class="summary-row">
                                <span class="summary-label">Equipment Rental</span>
                                <span class="summary-value" id="summaryRental">â‚±0.00</span>
                            </div>
                            <div class="summary-row">
                                <span class="summary-label">Duration</span>
                                <span class="summary-value" id="summaryDuration">0 days</span>
                            </div>
                            <div class="summary-row">
                                <span class="summary-label">Delivery Fee</span>
                                <span class="summary-value" id="summaryDelivery">â‚±100.00</span>
                            </div>
                            <div class="summary-row summary-total">
                                <span class="summary-label">Total Amount</span>
                                <span class="summary-value" id="summaryTotal">â‚±100.00</span>
                            </div>
                        </div>

                        <!-- Action Buttons -->
                        <div class="booking-actions">
                            <button type="submit" form="bookingForm" class="btn-confirm" id="confirmBooking">
                                Confirm Booking
                            </button>
                            <a href="rentals.html" class="btn-cancel">
                                Cancel
                            </a>
                        </div>
                    </div>
                </div>
            </div>
        </main>
    </div>
    
    <!-- Scripts -->
    <script src="/shared/js/components.js"></script>
    <script>
        /**
         * Booking Page JavaScript
         */
        const BookingPage = {
            // Equipment catalog data (in real app, this would come from API)
            equipment: {
                'symphony': { name: 'Grand Videoke Symphony', price: 800, category: 'Karaoke System' },
                'p90': { name: 'Platinum Karaoke P90', price: 650, category: 'Karaoke System' },
                'partybox': { name: 'Party Box Master V2', price: 500, category: 'Speaker System' },
                'wirelessmic': { name: 'Pro Wireless Mic Set', price: 300, category: 'Microphones' },
                'partybundle': { name: 'Ultimate Party Bundle', price: 1500, category: 'Party Bundle' },
            },

            selectedItem: null,
            pricePerDay: 800,
            deliveryFee: 100,

            init() {
                // Check authentication
                if (!Components.requireAuth()) {
                    return;
                }

                // Inject sidebar and topbar
                Components.injectSidebar('sidebarContainer', 'booking');
                Components.injectTopbar('topbarContainer', 'Book Equipment');

                // Get item from URL
                this.loadSelectedItem();

                // Initialize form
                this.initDateConstraints();
                this.initFormListeners();
                this.initFormSubmit();
            },

            /**
             * Load selected item from URL params
             */
            loadSelectedItem() {
                const params = new URLSearchParams(window.location.search);
                const itemId = params.get('item');

                if (itemId && this.equipment[itemId]) {
                    this.selectedItem = this.equipment[itemId];
                    this.pricePerDay = this.selectedItem.price;

                    // Update UI
                    document.getElementById('bookingItemName').textContent = this.selectedItem.name;
                    document.getElementById('bookingItemPrice').textContent = `â‚±${this.pricePerDay} / day`;
                } else {
                    // Default to first item if none selected
                    this.selectedItem = this.equipment['symphony'];
                    this.pricePerDay = this.selectedItem.price;
                }

                // Update summary
                this.updateSummary();
            },

            /**
             * Set date input constraints
             */
            initDateConstraints() {
                const today = new Date();
                const tomorrow = new Date(today);
                tomorrow.setDate(tomorrow.getDate() + 1);

                const formatDate = (date) => date.toISOString().split('T')[0];

                const startInput = document.getElementById('startDate');
                const endInput = document.getElementById('endDate');

                // Minimum start date is tomorrow
                startInput.min = formatDate(tomorrow);
                startInput.value = formatDate(tomorrow);

                // Update end date when start changes
                startInput.addEventListener('change', () => {
                    const startDate = new Date(startInput.value);
                    endInput.min = formatDate(startDate);
                    
                    // If end date is before start, reset it
                    if (new Date(endInput.value) < startDate) {
                        endInput.value = formatDate(startDate);
                    }
                    
                    this.updateSummary();
                });

                // Default end date is day after start
                const dayAfter = new Date(tomorrow);
                dayAfter.setDate(dayAfter.getDate() + 1);
                endInput.min = formatDate(tomorrow);
                endInput.value = formatDate(dayAfter);
            },

            /**
             * Initialize form change listeners
             */
            initFormListeners() {
                document.getElementById('startDate').addEventListener('change', () => this.updateSummary());
                document.getElementById('endDate').addEventListener('change', () => this.updateSummary());
            },

            /**
             * Update booking summary
             */
            updateSummary() {
                const startDate = new Date(document.getElementById('startDate').value);
                const endDate = new Date(document.getElementById('endDate').value);

                // Calculate duration
                const diffTime = Math.abs(endDate - startDate);
                const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24)) + 1; // Include both start and end

                // Calculate rental cost
                const rentalCost = this.pricePerDay * diffDays;
                const total = rentalCost + this.deliveryFee;

                // Update UI
                document.getElementById('summaryRental').textContent = `â‚±${rentalCost.toLocaleString()}.00`;
                document.getElementById('summaryDuration').textContent = `${diffDays} day${diffDays > 1 ? 's' : ''}`;
                document.getElementById('summaryDelivery').textContent = `â‚±${this.deliveryFee}.00`;
                document.getElementById('summaryTotal').textContent = `â‚±${total.toLocaleString()}.00`;
            },

            /**
             * Initialize form submit
             */
            initFormSubmit() {
                const form = document.getElementById('bookingForm');
                
                form.addEventListener('submit', (e) => {
                    e.preventDefault();
                    
                    // Validate form
                    if (!form.checkValidity()) {
                        form.reportValidity();
                        return;
                    }

                    // Get form data
                    const formData = {
                        item: this.selectedItem?.name || 'Unknown',
                        startDate: document.getElementById('startDate').value,
                        endDate: document.getElementById('endDate').value,
                        deliveryTime: document.getElementById('deliveryTime').value,
                        pickupTime: document.getElementById('pickupTime').value,
                        address: document.getElementById('deliveryAddress').value,
                        contact: document.getElementById('contactNumber').value,
                        payment: document.getElementById('paymentMethod').value,
                        notes: document.getElementById('specialRequests').value,
                    };

                    // In real app, this would submit to API
                    console.log('Booking submitted:', formData);
                    
                    // Show success and redirect
                    alert('Booking confirmed! You will receive a confirmation email shortly.');
                    window.location.href = 'dashboard.html';
                });
            }
        };

        // Initialize when DOM is ready
        document.addEventListener('DOMContentLoaded', () => {
            BookingPage.init();
        });
    </script>
</body>
</html>
